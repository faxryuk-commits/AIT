# EmotiCare Refactoring Roadmap

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å (`lib/emotional-memory.ts`)
- ‚úÖ –ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –∏–∑ –ø—Ä–æ—à–ª—ã—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–µ —ç–º–æ—Ü–∏–∏, –Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã)
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–º–∞—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- ‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—à–ª—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã ("–ü–æ–º–Ω—é, –Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥ —Ç—ã —Ç–æ–∂–µ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª...")

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ `session.emotionalMemory`

### 2. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (`app/api/telegram/webhook/route.ts`)
- ‚úÖ –ò–º—è AI-—Ç–µ—Ä–∞–ø–µ–≤—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Emo", –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ `/set_name`)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–Ω–∞ –æ–±—â–µ–Ω–∏—è: calm, warm, humorous, gentle, supportive
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: `/set_name [–∏–º—è]`, `/set_tone [tone]`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
/set_name –≠–º–æ
/set_tone warm
```

### 3. FSM –¥–ª—è —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (`lib/therapy-fsm.ts`)
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏—è: idle ‚Üí reflecting_emotion ‚Üí cognitive_reframing ‚Üí behavioral_suggestion ‚Üí summary
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- ‚úÖ –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –°–±—Ä–æ—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `idle` - –æ–±—ã—á–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ
- `reflecting_emotion` - –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —ç–º–æ—Ü–∏–∏
- `cognitive_reframing` - –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- `behavioral_suggestion` - –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- `summary` - –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤
- `crisis_support` - –∫—Ä–∏–∑–∏—Å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### 4. –≠–º–ø–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (`app/api/telegram/webhook/route.ts`)
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ —ç–º–æ—Ü–∏–π)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ "—Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è" –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
await showEmpathyDelay(telegramBotToken, chatId, delayMs)
```

### 5. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä–∏—Ç—É–∞–ª—ã (`app/api/telegram/webhook/route.ts`)
- ‚úÖ `/morning_checkin` –∏–ª–∏ `/—É—Ç—Ä–æ` - —É—Ç—Ä–µ–Ω–Ω–∏–π —á–µ–∫–∏–Ω
- ‚úÖ `/evening_reflection` –∏–ª–∏ `/–≤–µ—á–µ—Ä` - –≤–µ—á–µ—Ä–Ω—è—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–µ–∫–∏–Ω–∞/—Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å —É—á–µ—Ç–æ–º —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
/morning_checkin
/evening_reflection
```

### 6. –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —ç–º–æ—Ü–∏–π (`lib/emotion-analytics.ts`)
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏—Ö —ç–º–æ—Ü–∏–π
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `/emotions` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ—Ç—á–µ—Ç–æ–º

**–§—É–Ω–∫—Ü–∏–∏:**
- `analyzeEmotionTrends()` - –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
- `formatEmotionReport()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- ‚úÖ –≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å
- ‚úÖ –°–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ
- ‚úÖ –¢–∏—à–∏–Ω–∞ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç—å—é
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω –∏ —ç–º–ø–∞—Ç–∏—è

### 8. Emotional State Engine (`lib/emotional-state-engine.ts`)
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–æ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ —ç–º–æ—Ü–∏–π
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏—è temperature –¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —ç–º–ø–∞—Ç–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏—à–∏–Ω—ã –∏ –ø–∞—É–∑

**–¢–æ–Ω—ã:**
- `calm` - —Å–ø–æ–∫–æ–π–Ω—ã–π, —Ä–∞–∑–º–µ—Ä–µ–Ω–Ω—ã–π
- `warm` - —Ç–µ–ø–ª—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π
- `humorous` - —Å –ª–µ–≥–∫–∏–º —é–º–æ—Ä–æ–º
- `gentle` - –æ—á–µ–Ω—å –º—è–≥–∫–∏–π, –±–µ—Ä–µ–∂–Ω—ã–π
- `supportive` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### UserSession (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
```typescript
interface UserSession {
  messages: MessageWithEmotion[]
  messageCount: number
  lastSummaryAt: number
  createdAt: string
  emotionalMemory: EmotionalMemory
  therapyContext: TherapyContext
  emotionalState: EmotionalState | null
  personalization: {
    therapistName: string
    preferredTone: 'calm' | 'warm' | 'humorous' | 'gentle' | 'supportive'
  }
  lastCheckIn?: string
  lastReflection?: string
}
```

## üöÄ –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**
   - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
   - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –≤ –ë–î
   - [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

2. **–£–ª—É—á—à–µ–Ω–∏–µ FSM**
   - [ ] –ë–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
   - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
   - [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏**
   - [ ] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   - [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —ç–º–æ—Ü–∏–π
   - [ ] –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –º–µ—Å—è—Ü–∞)

4. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - [ ] –ì—Ä–∞—Ñ–∏–∫–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤
   - [ ] –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ —ç–º–æ—Ü–∏—è–º–∏
   - [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

5. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**
   - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–æ–Ω–∞
   - [ ] –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
   - [ ] –£—á–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
   - [ ] –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∞–∂–Ω—ã—Ö –¥–∞—Ç
   - [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ä–∏—Ç—É–∞–ª–∞—Ö
   - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ wellness-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (3-6 –º–µ—Å—è—Ü–µ–≤)

7. **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å**
   - [ ] –ê–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (—Ç–æ–Ω, —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏)
   - [ ] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–π –≤ –≥–æ–ª–æ—Å–µ
   - [ ] –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–∏–ø –º–µ–¥–∏–∞ (—Ç–µ–∫—Å—Ç/–≥–æ–ª–æ—Å/—Ñ–æ—Ç–æ)

8. **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**
   - [ ] –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –≥—Ä—É–ø–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - [ ] –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
   - [ ] –û–±–º–µ–Ω –æ–ø—ã—Ç–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

9. **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è —Ç–µ—Ä–∞–ø–µ–≤—Ç–æ–≤
   - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
   - [ ] –†–µ–∂–∏–º "—Ç–µ—Ä–∞–ø–µ–≤—Ç-–∫–ª–∏–µ–Ω—Ç" —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–æ—Å—Ç—É–ø–∞

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI
- [ ] Batch processing –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- [ ] –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ GDPR/CCPA

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- [ ] –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –û—á–µ—Ä–µ–¥–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–¥—É

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **`lib/emotional-memory.ts`**
   - –°–∏—Å—Ç–µ–º–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏
   - –§—É–Ω–∫—Ü–∏–∏: `getRelevantMemories()`, `updateEmotionalMemory()`
   - –•—Ä–∞–Ω–∏—Ç –¥–æ 50 —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, 20 —Ç–µ–º, 8 –Ω–µ–¥–µ–ª—å —Ç—Ä–µ–Ω–¥–æ–≤

2. **`lib/therapy-fsm.ts`**
   - FSM –¥–ª—è —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ç–æ–∫–∞
   - –§—É–Ω–∫—Ü–∏–∏: `transitionState()`, `getStatePrompt()`, `updateContext()`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –ø–æ—Å–ª–µ 10 –º–∏–Ω—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ 30 –º–∏–Ω—É—Ç —Å–µ—Å—Å–∏–∏

3. **`lib/emotional-state-engine.ts`**
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∫ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
   - –§—É–Ω–∫—Ü–∏–∏: `adaptToEmotionalState()`, `updateEmotionalState()`
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ–Ω, –¥–ª–∏–Ω—É, temperature, —É—Ä–æ–≤–µ–Ω—å —ç–º–ø–∞—Ç–∏–∏

4. **`lib/emotion-analytics.ts`**
   - –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤
   - –§—É–Ω–∫—Ü–∏–∏: `analyzeEmotionTrends()`, `formatEmotionReport()`
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∏ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é

5. **`app/api/telegram/webhook/route.ts`**
   - –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –≤—Å–µ —Å–∏—Å—Ç–µ–º—ã
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- –í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏
- –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∏—Ç—É–∞–ª–æ–≤
- –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å (—á–µ—Ä–µ–∑ –æ–ø—Ä–æ—Å—ã)
- Retention rate

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- –¢–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —ç–º–æ—Ü–∏–π
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –ü–ª–∞–≤–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ FSM
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [OpenAI API Documentation](https://platform.openai.com/docs)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [CBT Techniques](https://www.apa.org/ptsd-guideline/patients-and-families/cognitive-behavioral)

### –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
- Emotional AI –∏ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- FSM –≤ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏–∏
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤ mental health tech

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-XX
**–í–µ—Ä—Å–∏—è:** 2.0.0

